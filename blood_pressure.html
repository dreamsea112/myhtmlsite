<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>è¡€å£“ç´€éŒ„</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
  background: #f5f5f5;
  padding: 20px;
}
.box {
  background: #fff;
  padding: 20px;
  border-radius: 10px;
  max-width: 420px;
  margin: auto;
  box-shadow: 0 0 10px rgba(0,0,0,.1);
}
input, button {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
  font-size: 16px;
}
button {
  background: #007bff;
  color: #fff;
  border: none;
  border-radius: 6px;
}
.hidden {
  display: none;
}
</style>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>

<body>

<div class="box" id="loginBox">
  <h2>ğŸ”’ è¼¸å…¥å¯†ç¢¼</h2>
  <input type="password" id="password" placeholder="è«‹è¼¸å…¥å¯†ç¢¼">
  <button onclick="verifyPassword()">é©—è­‰</button>
  <p id="loginMsg"></p>
</div>

<div class="box hidden" id="bpBox">
  <h2>ğŸ©º è¡€å£“ç´€éŒ„</h2>
  <input type="number" id="sys" placeholder="æ”¶ç¸®å£“">
  <input type="number" id="dia" placeholder="èˆ’å¼µå£“">
  <input type="number" id="pulse" placeholder="å¿ƒè·³">
  <button onclick="saveBP()">å„²å­˜</button>
  <p id="bpMsg"></p>

  <hr>
  <button onclick="logout()" style="background:#dc3545">è§£é™¤æ­¤è£ç½®ä¿¡ä»»</button>
</div>

<script>
// ===== Firebase è¨­å®š=====
const firebaseConfig = {
  apiKey: "AIzaSyB4S2D1GpRME4ZXccqczkUFtqGIfhgjstI",
  authDomain: "my-health-record-1a9f2.firebaseapp.com",
  databaseURL: "https://my-health-record-1a9f2-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "my-health-record-1a9f2",
  storageBucket: "my-health-record-1a9f2.firebasestorage.app",
  messagingSenderId: "884879920046",
  appId: "1:884879920046:web:b3a7505188d0781907163f"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ===== å•Ÿå‹•æ™‚æª¢æŸ¥æ˜¯å¦å·²é©—è­‰ =====
if (localStorage.getItem("bp_auth") === "ok") {
  showBP();
}

// ===== é¡¯ç¤ºåˆ‡æ› =====
function showLogin() {
  loginBox.classList.remove("hidden");
  bpBox.classList.add("hidden");
}
function showBP() {
  loginBox.classList.add("hidden");
  bpBox.classList.remove("hidden");
}

// ===== é©—è­‰å¯†ç¢¼ï¼ˆç”¨ Firebase Rules åˆ¤æ–·ï¼‰=====
function verifyPassword() {
  const pwd = password.value;
  loginMsg.textContent = "é©—è­‰ä¸­â€¦";

  const testRef = db.ref("auth_test").push();

  testRef.set({
    pwd: pwd,
    time: Date.now()
  })
  .then(() => {
    localStorage.setItem("bp_auth", "ok");
    loginMsg.textContent = "é©—è­‰æˆåŠŸ";
    showBP();
  })
  .catch(() => {
    loginMsg.textContent = "å¯†ç¢¼éŒ¯èª¤";
  });
}

// ===== å„²å­˜è¡€å£“ =====
function saveBP() {
  const data = {
    sys: Number(sys.value),
    dia: Number(dia.value),
    pulse: Number(pulse.value),
    time: Date.now()
  };

  db.ref("bp_records").push(data)
    .then(() => bpMsg.textContent = "å·²å„²å­˜")
    .catch(() => bpMsg.textContent = "å¯«å…¥å¤±æ•—ï¼ˆæœªæˆæ¬Šï¼‰");
}

// ===== è§£é™¤è£ç½®ä¿¡ä»» =====
function logout() {
  localStorage.removeItem("bp_auth");
  showLogin();
}
</script>

</body>
</html>
