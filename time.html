<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>時間與網速換算器</title>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: #e0f0ff;
      color: #003366;
      text-align: center;
      padding: 30px;
    }

    h1#clock {
      font-size: 48px;
      margin-bottom: 40px;
    }

    .section {
      background: #ffffffcc;
      padding: 20px;
      margin: 20px auto;
      border-radius: 20px;
      max-width: 500px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    input, select, button {
      padding: 10px;
      margin: 8px;
      border: 1px solid #a0c8e0;
      border-radius: 8px;
      font-size: 16px;
    }

    button {
      background-color: #4da6ff;
      color: white;
      border: none;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background-color: #3399ff;
    }

    .output {
      margin-top: 10px;
      font-weight: bold;
      font-size: 18px;
    }

            .footer {
            margin-top: 20px;
            font-size: 16px;
            color: #666;
        }
        .footer p {
            color: #003366;
            font-weight: bold;
        }
  </style>
</head>
<body>
  <h1 id="clock">--:--:--</h1>

  <div class="section">
    <h2>時間換算</h2>
    <input type="number" id="minutesInput" placeholder="輸入分鐘數">
    <button onclick="convertTime()">換算</button>
    <button onclick="resetTime()">刪除</button>
    <div class="output" id="hourOutput">結果：-- 小時</div>
    <div class="output" id="futureTimeOutput">加上後的時間：--</div>
  </div>

  <div class="section">
    <h2>網路速度換算</h2>
    <input type="number" id="speedInput" placeholder="輸入數值">
    <select id="unitSelect">
      <option value="MBps">MB/s</option>
      <option value="Mbps">Mbps</option>
    </select>
    <button onclick="convertSpeed()">換算</button>
    <button onclick="resetSpeed()">刪除</button>
    <div class="output" id="speedResult">換算結果：--</div>
  </div>
          <div class="footer">
            <p>by:慶宗</p>
        </div>

  <script>
    // 新增：線上時間物件與 fallback 機制
    let currentTime = null; // 儲存目前時間
    let useFallback = false; // 是否使用本地時間
    let lastSync = 0; // 最近一次線上同步的時間戳記

    // 新增：同步線上時間，並 fallback 至本地時間
    async function syncOnlineTime() {
      try {
        const response = await fetch('https://worldtimeapi.org/api/timezone/Asia/Taipei');
        const data = await response.json();
        currentTime = new Date(data.datetime);
        useFallback = false; // 成功取得線上時間，不使用 fallback
        lastSync = Date.now(); // 記錄同步時間戳
      } catch (error) {
        // 若無法取得線上時間，則改為使用本地時間
        currentTime = new Date();
        useFallback = true;
      }
    }

    // 新增：每秒更新時鐘顯示
    function updateClockDisplay() {
      if (!currentTime) {
        document.getElementById('clock').textContent = '載入中...';
        return;
      }

      // 顯示目前時間（格式為台灣地區標準）
      const options = {
        year: 'numeric', month: '2-digit', day: '2-digit',
        hour: '2-digit', minute: '2-digit', second: '2-digit'
      };
      document.getElementById('clock').textContent = currentTime.toLocaleString('zh-TW', options);

      // 每秒遞增 1 秒模擬時鐘前進
      currentTime.setSeconds(currentTime.getSeconds() + 1);

      // 每 30 秒嘗試重新從網路同步時間
      if (Date.now() - lastSync >= 30000) {
        syncOnlineTime();
      }
    }

    // 新增：初始化與啟動時鐘
    syncOnlineTime();
    setInterval(updateClockDisplay, 1000);

    function convertTime() {
      const minutes = parseInt(document.getElementById('minutesInput').value);
      if (isNaN(minutes)) return;

      const hoursPart = Math.floor(minutes / 60);
      const minutesPart = minutes % 60;
      document.getElementById('hourOutput').textContent = `結果：${hoursPart} 小時 ${minutesPart} 分`;

      const now = new Date();
      now.setMinutes(now.getMinutes() + minutes);
      document.getElementById('futureTimeOutput').textContent = `加上後的時間：${now.toLocaleString('zh-TW')}`;
    }

    function resetTime() {
      document.getElementById('minutesInput').value = '';
      document.getElementById('hourOutput').textContent = '結果：-- 小時';
      document.getElementById('futureTimeOutput').textContent = '加上後的時間：--';
    }

    function convertSpeed() {
      const val = parseFloat(document.getElementById('speedInput').value);
      const unit = document.getElementById('unitSelect').value;

      if (isNaN(val)) return;

      let result = '';
      if (unit === 'MBps') {
        result = `${(val * 8).toFixed(2)} Mbps`;
      } else {
        result = `${(val / 8).toFixed(2)} MB/s`;
      }

      document.getElementById('speedResult').textContent = `換算結果：${result}`;
    }

    function resetSpeed() {
      document.getElementById('speedInput').value = '';
      document.getElementById('speedResult').textContent = '換算結果：--';
    }
  </script>
</body>
</html>
